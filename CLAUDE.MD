# CLAUDE.MD - Инструкции для AI-ассистента

## Информация о проекте

**Репозиторий:** snowkukolkina-sudo/repo-02-01-2026
**Проект:** DANDY Pizza - платформа доставки пиццы и суши
**Назначение:** Комплексная система e-commerce и управления рестораном с интеграциями для российских предприятий

### Описание проекта

DANDY Pizza - это полнофункциональная платформа, объединяющая:
- **Клиентское веб-приложение**: меню, заказ, отслеживание заказов, управление профилем
- **Административная система**: управление продуктами, инвентарём, персоналом, ценообразованием
- **Интеграции**: ЭДО через Диадок, интеграция с 1C, поддержка агрегаторов
- **Бизнес-операции**: кассовые отчёты, программы лояльности, система соответствия требованиям

### Технологический стек

**Backend:**
- Node.js/Express.js (основной backend)
- PHP (устаревший API-слой)
- SQLite3 / PostgreSQL (базы данных)

**Frontend:**
- HTML5, JavaScript (Vanilla)
- Модульная архитектура для админ-панели

**Ключевые зависимости:**
- express, axios, multer, sqlite3, pg, xlsx, csv-parse, xml2js, dotenv

---

## Git - Правила работы с версионным контролем

### Обязательные действия при изменении файлов

Каждый раз, когда AI вносит изменения в проект, необходимо:

1. **Проверить статус изменений:**
```bash
git status
```

2. **Добавить изменённые файлы:**
```bash
# Добавить конкретный файл
git add имя_файла.расширение

# Или добавить все изменения
git add .
```

3. **Создать коммит с осмысленным сообщением:**
```bash
git commit -m "Описание изменений на русском языке"
```

**Примеры хороших сообщений коммитов:**
- `git commit -m "Добавлена функция обработки данных"`
- `git commit -m "Исправлена ошибка в расчёте скидок"`
- `git commit -m "Обновлена документация API"`
- `git commit -m "Рефакторинг модуля авторизации"`

4. **Отправить изменения на GitHub:**
```bash
git push origin main
```

---

## Workflow при работе с проектом

### Перед началом работы:
```bash
# Убедиться, что работаешь с актуальной версией
git pull origin main
```

### После внесения изменений:
```bash
# Шаг 1: Проверить что изменилось
git status

# Шаг 2: Просмотреть детали изменений (опционально)
git diff

# Шаг 3: Добавить файлы
git add .

# Шаг 4: Создать коммит
git commit -m "Краткое описание изменений"

# Шаг 5: Отправить на GitHub
git push origin main
```

---

## Структура проекта

### Основные директории:

- **`api/`** - Backend API модули (Node.js)
  - `admin_state_backend.js` - управление состоянием админки
  - `aggregator_backend.js` - интеграция с агрегаторами
  - `auth_backend.js` - аутентификация и авторизация
  - `catalog_backend.js` - каталог продуктов
  - `diadoc_backend.js` - интеграция с Диадок ЭДО
  - `inventory_backend.js` - управление инвентарём
  - `loyalty_backend.js` - программа лояльности
  - и другие...

- **`services/`** - бизнес-логика
  - `catalog_store.js` - управление каталогом
  - `inventory_state_store.js` - логика инвентаря
  - `diadoc_importer.js` - импорт из Диадок
  - `integration_bus.js` - оркестрация интеграций
  - и другие сервисы...

- **`modules/`** - фронтенд-модули админки
  - `admin-product-cards.js` - управление карточками товаров
  - `admin-edo-module.js` - интерфейс ЭДО
  - `admin-1c-integration.js` - интеграция с 1C
  - и другие модули...

- **`config/`** - конфигурационные файлы
  - `ai-connectors.json` - настройка AI-коннекторов
  - `ai-branch-management.json` - стратегия управления ветками
  - `auth-users.json` - конфигурация пользователей
  - и другие конфиги...

- **`docs/`** - документация
  - `edo-deployment-checklist.md` - чеклист развёртывания ЭДО
  - `edo-env-template.md` - шаблон переменных окружения

- **`storage/`** - хранилище данных
- **`security/`** - модули безопасности
- **`assets/`** - медиа-ресурсы и брендинг

### Ключевые файлы:

- `server.js` - главный Express-сервер
- `database.sqlite` - основная база данных
- `menu_data.json` - данные меню (303KB)
- `index.html` - главная страница клиента
- `admin.html` - панель администратора
- `package.json` - зависимости Node.js

---

## Особенности проекта

### Интеграции:
- **Диадок** - система электронного документооборота (ЭДО) для России
- **1C** - интеграция с бухгалтерским ПО
- **Агрегаторы** - Яндекс.Еда, Uber Eats и др.

### AI-готовность:
Проект настроен для работы с AI через:
- `config/ai-connectors.json` - коннекторы ChatGPT, Claude, Perplexity
- `config/ai-branch-management.json` - автоматическое управление ветками
- `config/system-architecture-analysis.json` - анализ архитектуры

---

## Важные замечания для AI

### При работе с кодом:

1. **ВСЕГДА** делай коммит и push после внесения изменений
2. Сообщения коммитов на русском языке
3. Проект использует гибридную архитектуру (PHP + Node.js)
4. База данных: SQLite для разработки, PostgreSQL для продакшена
5. Интерфейс и документация на русском языке (Cyrillic)

### При работе с API:

- Backend Node.js: порт настраивается через `.env`
- PHP API: `api/index.php` - устаревший слой совместимости
- CORS настроен в `api/index.php`

### При работе с модулями:

- Модульная архитектура в `modules/`
- Каждый модуль - отдельная область функционала
- Состояние хранится в `storage/` и `services/`

### При работе с интеграциями:

- Диадок требует OAuth-аутентификации
- 1C импорт через `admin-1c-import.js`
- Агрегаторы управляются через `aggregator_backend.js`

---

## Workflow для новых функций

1. **Планирование**: используй TodoWrite для разбивки задачи
2. **Исследование**: изучи существующий код перед изменениями
3. **Разработка**: следуй существующим паттернам проекта
4. **Тестирование**: проверь работоспособность
5. **Коммит**: осмысленное сообщение на русском
6. **Push**: отправь изменения на GitHub

---

## Настройка Git (если ещё не настроен)

```bash
# Установить имя пользователя
git config --global user.name "Ваше Имя"

# Установить email
git config --global user.email "ваш_email@example.com"

# Включить длинные пути (для Windows)
git config --global core.longpaths true
```

---

## Проверка настроек

```bash
# Посмотреть текущую конфигурацию
git config --list

# Проверить удалённый репозиторий
git remote -v
```

---

## Работа с ветками

```bash
# Создать новую ветку
git checkout -b название_ветки

# Переключиться на другую ветку
git checkout название_ветки

# Посмотреть все ветки
git branch -a

# Слить ветку в main
git checkout main
git merge название_ветки
```

---

## Частые проблемы и решения

### Конфликт при push
```bash
# Сначала получить изменения с сервера
git pull origin main

# Разрешить конфликты вручную, затем
git add .
git commit -m "Разрешены конфликты слияния"
git push origin main
```

### Отменить последний коммит (до push)
```bash
git reset --soft HEAD~1
```

### Посмотреть историю коммитов
```bash
git log --oneline
```

---

## .gitignore - важные исключения

Проект должен исключать из версионного контроля:
- `node_modules/` - зависимости Node.js
- `.env` - переменные окружения с секретами
- `*.sqlite` - локальные базы данных (опционально)
- `storage/` - пользовательские данные (опционально)
- Временные файлы и логи

---

## Полезные команды для проекта

### Запуск проекта:
```bash
# Установить зависимости
npm install

# Запустить сервер
node server.js
```

### Работа с базой данных:
```bash
# Посмотреть таблицы SQLite
sqlite3 database.sqlite ".tables"

# Выполнить SQL-запрос
sqlite3 database.sqlite "SELECT * FROM users;"
```

---

## Контрольный список перед коммитом

- [ ] Код протестирован и работает
- [ ] Нет закомментированного мёртвого кода
- [ ] Сообщения на русском языке (если UI/UX)
- [ ] Файлы `.env` не включены в коммит
- [ ] Сообщение коммита осмысленное и на русском
- [ ] Проверен `git status` перед `git add`
- [ ] Выполнен `git pull` перед `git push`

---

## MCP Серверы (Model Context Protocol)

### Что такое MCP?

Model Context Protocol (MCP) - это открытый стандарт от Anthropic для интеграции AI-систем с внешними инструментами и источниками данных. MCP позволяет Claude Code подключаться к различным сервисам и расширять свои возможности.

### Установленные MCP серверы

Для этого проекта настроены следующие MCP серверы:

#### 1. **Context7** (@upstash/context7-mcp)

**Назначение:** Предоставляет актуальную, версионно-специфичную документацию библиотек прямо в контекст AI.

**Возможности:**
- Динамическое получение официальной документации библиотек
- Актуальные примеры кода без устаревшей информации
- Версионно-специфичная документация
- Поддержка множества популярных библиотек

**Как использовать:**
Просто упомяните "use context7" в запросе к Claude, и сервер автоматически подгрузит актуальную документацию.

```
Пример: "use context7 покажи как использовать React hooks в версии 18"
```

**Ресурсы:**
- Документация: https://mcpmarket.com/server/context7-http
- GitHub: https://github.com/upstash/context7-mcp

#### 2. **Playwright** (@playwright/mcp@latest)

**Назначение:** Автоматизация браузера для тестирования и веб-скрапинга.

**Возможности:**
- Автоматизация действий в браузере (клики, ввод текста, навигация)
- Создание скриншотов веб-страниц
- Тестирование веб-приложений
- Заполнение форм и взаимодействие с элементами
- Поддержка Chromium, Firefox, WebKit

**Как использовать:**
Просто попросите Claude выполнить действия в браузере:

```
Примеры:
- "Сделай скриншот главной страницы"
- "Протестируй процесс входа с test@example.com"
- "Проверь, правильно ли работает корзина на сайте"
```

**Ресурсы:**
- Документация: https://playwright.dev/
- MCP сервер: https://github.com/microsoft/playwright

### Конфигурация MCP

MCP серверы настроены в файле `~/.claude.json` для локального проекта:

```json
{
  "mcpServers": {
    "context7": {
      "type": "stdio",
      "command": "cmd",
      "args": ["C:/", "npx", "-y", "@upstash/context7-mcp"],
      "env": {}
    },
    "playwright": {
      "type": "stdio",
      "command": "cmd",
      "args": ["C:/", "npx", "-y", "@playwright/mcp@latest"],
      "env": {}
    }
  }
}
```

### Управление MCP серверами

#### Просмотр установленных серверов:
```bash
claude mcp list
```

#### Получение информации о сервере:
```bash
claude mcp get context7
claude mcp get playwright
```

#### Добавление нового MCP сервера:
```bash
# Для Windows (обязательно используйте cmd /c для npx)
claude mcp add --transport stdio --scope local имя_сервера -- cmd /c npx -y пакет

# Пример:
claude mcp add --transport stdio --scope local github -- cmd /c npx -y @modelcontextprotocol/server-github
```

#### Удаление MCP сервера:
```bash
claude mcp remove имя_сервера
```

#### Проверка статуса в Claude Code:
```bash
/mcp
```

### Области видимости (Scope)

MCP серверы можно устанавливать в разных областях:

- **local** - только для текущего проекта (в `~/.claude.json`)
- **project** - для всей команды (в `.mcp.json` в корне проекта, коммитится в Git)
- **user** - для всех проектов пользователя

**Рекомендация:** Используйте `--scope local` для личной разработки, `--scope project` для командной работы.

### Популярные MCP серверы

Помимо установленных, вы можете добавить:

- **GitHub** - работа с репозиториями, issues, PR
- **Filesystem** - расширенная работа с файловой системой
- **PostgreSQL** - прямые запросы к базе данных
- **Brave Search** - поиск в интернете
- **Sentry** - мониторинг ошибок
- **Slack** - интеграция с командным чатом

Реестр MCP серверов: https://github.com/modelcontextprotocol/servers

### Особенности для Windows

**ВАЖНО:** При установке MCP серверов на Windows необходимо использовать обёртку `cmd /c` для команд `npx`:

```bash
# Правильно (Windows):
claude mcp add --transport stdio --scope local server -- cmd /c npx -y package

# Неправильно (вызовет ошибку "Connection closed"):
claude mcp add --transport stdio --scope local server -- npx -y package
```

### Устранение проблем

**Проблема:** "Connection closed" при запуске MCP сервера
**Решение:** Убедитесь, что используете `cmd /c` перед `npx` на Windows

**Проблема:** Медленная инициализация сервера
**Решение:** Увеличьте таймаут:
```bash
set MCP_TIMEOUT=10000
claude
```

**Проблема:** Сервер не отображается в списке
**Решение:** Проверьте синтаксис конфигурации в `~/.claude.json`

---

## Ресурсы и документация

**Внутренняя документация:**
- `/docs/edo-deployment-checklist.md` - развёртывание ЭДО
- `/docs/edo-env-template.md` - шаблон переменных окружения

**Конфигурация:**
- `/config/ai-connectors.json` - настройка AI
- `/config/ai-branch-management.json` - управление ветками
- `/config/system-architecture-analysis.json` - анализ архитектуры

**MCP серверы:**
- Context7: https://mcpmarket.com/server/context7-http
- Playwright: https://playwright.dev/
- MCP Registry: https://github.com/modelcontextprotocol/servers
- Claude Code MCP Docs: https://code.claude.com/docs/en/mcp.md

---

*Файл создан автоматически AI-ассистентом на основе анализа структуры проекта*
